# Define geography
# Geographies and calls here:https://walkerke.github.io/tidycensus/articles/basic-usage.html
# Geometry = T/F for coordinates
census_data <-get_decennial (state = "06", #California
geography = "tract",
variables = vars,
geometry = T,
output = "wide",
year = 2010)
census_data$race_white_per = census_data$race_white / census_data$population_race #White NH
census_data$race_black_per = census_data$race_black / census_data$population_race #Black NH
census_data$race_amindian_per = census_data$race_amindian / census_data$population_race #American Indian NH
census_data$race_asian_per = census_data$race_asian / census_data$population_race #Asian  NH
census_data$race_pacisl_per = census_data$race_pacisl / census_data$population_race #Pacific islander NH
census_data$race_other_per = census_data$race_other / census_data$population_race #Other NH
census_data$race_twoplus_per = census_data$race_twoplus / census_data$population_race #Two or more NH
census_data$race_hisp_per = census_data$race_hisp / census_data$population_race #Hispanic/Latino of any race
census_data$renter_per = census_data$renterHH / census_data$totalHH #Renters
census_data$GEOID_Numeric <-
as.numeric(census_data$GEOID) #Create a numeric join column in the Census Data
particulatematter.data$GEOID_Numeric <- #Create a numeric join column in the PM Data
as.numeric(particulatematter.data$GEOID10)
joinedData <-
merge(
census_data,
activetransport.data,
by.x = 'GEOID_Numeric',
by.y = 'fipsct...1',
all.x = T
)  #Join the Active Transport and Demographic Variables
joinedData <-
merge(
joinedData,
medianincome.data,
by.x = 'GEOID_Numeric',
by.y = 'GEOID',
all.x = T
)  #Join Median Income Information
joinedData <-
merge(
joinedData,
particulatematter.data,
by.x = 'GEOID_Numeric',
by.y = 'GEOID_Numeric',
all.x = F
) #Join AQ and drop tracts
#Create a smaller database for our use, that only includes the variables we are concerned about.
small.data <- joinedData %>% select(
GEOID,
GEOID_Numeric,
NAME,
population_race,
race_white_per,
race_black_per,
race_asian_per,
race_amindian_per,
race_pacisl_per,
race_other_per,
race_hisp_per,
race_twoplus_per,
renter_per,
popdense,
land_area,
miles_b_chts,
miles_w_chts,
MEAN,
`Households!!Estimate!!Median income (dollars)`,
nh_type,
geometry
)
small.data <-
small.data %>% rename(PM_mean = MEAN, income = `Households!!Estimate!!Median income (dollars)`) #rename columns for easier use
small.data$income <-
small.data$income %>% as.numeric() #Change income to a numeric variable
small.data$nh_type_str <-
small.data$nh_type %>% as.character() #Change the Neighborhood Type Variable to be a character so we can run a logistic regresssion with it as a parameter.
small.data <-
small.data %>% mutate(miles_biked_walked_total = miles_b_chts + miles_w_chts) %>% #Add Walked + Biked Totals together
mutate(miles_bike_walked_percapita = miles_biked_walked_total / population_race) %>%  # Scale teh Walked + BIked by population
mutate(nonwhite_per = race_black_per +  race_asian_per+ race_amindian_per + race_pacisl_per +
race_other_per + race_hisp_per+race_twoplus_per) %>% # Add a percent nonwhite column
mutate(pop_dens_sqm = population_race/land_area) #Calculate a new density
set.seed(1234)
small.data.k <- small.data %>% select(  #Select the variables we would like to cluster off of.
GEOID,
population_race,
pop_dens_sqm,
land_area,
PM_mean,
income,
miles_bike_walked_percapita,
nonwhite_per
)
rownames(small.data.k) <- small.data.k$GEOID #Set the rownames to the Census GEOID
small.data.k <-
small.data.k[-c(small.data.k$GEOID == '06037911001'),]  # Drop single outlier which is very different than all other tracts. Tract 06037911001
small.data.k <- select(small.data.k,-GEOID) #Remove the GEOID Column (it won't work with K Means)
small.data.k <-
small.data.k %>% st_drop_geometry() #drop geometry column
small.data.k <- na.omit(small.data.k) #remove all NA values
small.data.k.scaled <-
scale(small.data.k) #scale data to be between 0 and 1
km <- kmeans(small.data.k.scaled, centers = 4, nstart = 50) #Use four clusters (due to NH_Type)
fviz_cluster(km, data = small.data.k.scaled)
km.cluster <- km$cluster
km.cluster <- as.data.frame(km.cluster)
small.data.k$GEOID <- small.data.k %>% rownames()
km.cluster$GEOID <- km.cluster %>% rownames()
small.data.joined <-
merge(km.cluster, small.data, by.x = 'GEOID', by.y = 'GEOID')
small.data.joined <-
small.data.joined %>% rename(clusterID = km.cluster)
aggregate(small.data.joined,
by = list(cluster = small.data.joined$clusterID),
mean) #Summary Statistics for the different clusters.
aggregate(small.data.joined,
by = list(cluster = small.data.joined$clusterID),
median) #Summary Statistics for the different clusters.
aggregate(small.data.joined,
by = list(cluster = small.data.joined$clusterID),
mean) #Summary Statistics for the different clusters.
ggplot(data=small.data.joined,aes(y=PM_mean,x=reorder(as.factor(clusterID)),PM_Mean)+
ggplot(data=small.data.joined,aes(y=PM_mean,x=reorder(as.factor(clusterID)),PM_Mean)).+
ggplot(data=small.data.joined,aes(y=PM_mean,x=reorder(as.factor(clusterID)),PM_Mean))+
geom_boxplot()+
labs(
title = 'PM 2.5 by Cluster',
subtitle = 'By Census Tract in Los Angeles County',
x = 'Cluster ID',
y = 'PM 2.5 (ug/m3)',
) +
#scale_x_discrete(labels=c('Rural','Higher Income Suburb','Urban','Lower Income Suburb'))+
theme_minimal()
ggplot(data=small.data.joined,aes(y=PM_mean,x=reorder(as.factor(clusterID),PM_Mean))+
ggplot(data=small.data.joined,aes(y=PM_mean,x=reorder(as.factor(clusterID),PM_Mean))+
ggplot(data=small.data.joined,aes(y=PM_mean,x=reorder(as.factor(clusterID),PM_Mean)))+
geom_boxplot()+
labs(
title = 'PM 2.5 by Cluster',
subtitle = 'By Census Tract in Los Angeles County',
x = 'Cluster ID',
y = 'PM 2.5 (ug/m3)',
) +
#scale_x_discrete(labels=c('Rural','Higher Income Suburb','Urban','Lower Income Suburb'))+
theme_minimal()
ggplot(data=small.data.joined,aes(y=PM_mean,x=reorder(as.factor(clusterID),PM_Mean))+
ggplot(data=small.data.joined,aes(y=PM_mean,x=reorder(as.factor(clusterID),PM_Mean))+
ggplot(data=small.data.joined,aes(y=PM_mean,x=reorder(as.factor(clusterID),PM_Mean))+
ggplot(data=small.data.joined,aes(y=PM_mean,x=reorder(as.factor(clusterID),PM_Mean))+
ggplot(data=small.data.joined,aes(y=PM_mean,x=reorder(as.factor(clusterID),PM_Mean)))+
geom_boxplot()+
labs(
title = 'PM 2.5 by Cluster',
subtitle = 'By Census Tract in Los Angeles County',
x = 'Cluster ID',
y = 'PM 2.5 (ug/m3)',
) +
#scale_x_discrete(labels=c('Rural','Higher Income Suburb','Urban','Lower Income Suburb'))+
theme_minimal()
ggplot(data=small.data.joined,aes(y=PM_mean,x=reorder(as.factor(clusterID),PM_Mean)))+
ggplot(data=small.data.joined,aes(y=PM_mean,x=reorder(as.factor(clusterID),PM_Mean))+
ggplot(data=small.data.joined,aes(y=PM_mean,x=reorder(as.factor(clusterID),PM_Mean))+
ggplot(data=small.data.joined,aes(y=PM_mean,x=as.factor(clusterID),PM_Mean))+
geom_boxplot()+
labs(
title = 'PM 2.5 by Cluster',
subtitle = 'By Census Tract in Los Angeles County',
x = 'Cluster ID',
y = 'PM 2.5 (ug/m3)',
) +
theme_minimal()
ggplot(data=small.data.joined,aes(y=PM_mean,x=as.factor(clusterID),PM_Mean))+
geom_boxplot()+
labs(
title = 'PM 2.5 by Cluster',
subtitle = 'By Census Tract in Los Angeles County',
x = 'Cluster ID',
y = 'PM 2.5 (ug/m3)',
) +
theme_minimal()+
scale_x_discrete(labels=c('Rural','Higher Income Suburb','Urban','Lower Income Suburb'))+
ggplot(data=small.data.joined,aes(y=miles_bike_walked_percapita,x=as.factor(clusterID)))+
geom_boxplot()
ggplot(data=small.data.joined,aes(y=PM_mean,x=as.factor(clusterID),PM_Mean))+
geom_boxplot()+
labs(
title = 'PM 2.5 by Cluster',
subtitle = 'By Census Tract in Los Angeles County',
x = 'Cluster ID',
y = 'PM 2.5 (ug/m3)',
) +
theme_minimal()+
scale_x_discrete(labels=c('Rural','Higher Income Suburb','Urban','Lower Income Suburb'))
aggregate(small.data.joined,
by = list(cluster = small.data.joined$clusterID),
mean) #Summary Statistics for the different clusters.
ggplot(data=small.data.joined,aes(y=PM_mean,x=as.factor(clusterID, levels = c('3','2','1','4'),ordered=TRUE),PM_Mean))+
geom_boxplot()+
labs(
title = 'PM 2.5 by Cluster',
subtitle = 'By Census Tract in Los Angeles County',
x = 'Cluster ID',
y = 'PM 2.5 (ug/m3)',
) +
theme_minimal()+
scale_x_discrete(labels=c('Rural','Higher Income Suburb','Urban','Lower Income Suburb'))
ggplot(data=small.data.joined,aes(y=PM_mean,x=as.factor(clusterID, levels = c(3,2,1,4),ordered=TRUE),PM_Mean))+
geom_boxplot()+
labs(
title = 'PM 2.5 by Cluster',
subtitle = 'By Census Tract in Los Angeles County',
x = 'Cluster ID',
y = 'PM 2.5 (ug/m3)',
) +
theme_minimal()+
scale_x_discrete(labels=c('Rural','Higher Income Suburb','Urban','Lower Income Suburb'))
small.data.joined$clusterName
small.data.joined[small.data.joined$clusterID ==1,'clusterName'] =
aggregate(small.data.joined,
by = list(cluster = small.data.joined$clusterID),
mean) #Summary Statistics for the different clusters.
small.data.joined[small.data.joined$clusterID ==1,'clusterName'] =
aggregate(small.data.joined,
by = list(cluster = small.data.joined$clusterID),
mean) #Summary Statistics for the different clusters.
small.data.joined[small.data.joined$clusterID ==1,'clusterName'] =
aggregate(small.data.joined,
by = list(cluster = small.data.joined$clusterID),
mean) #Summary Statistics for the different clusters.
ggplot(data=small.data.joined,aes(y=PM_mean,x=as.factor(clusterID, PM_Mean))+
ggplot(data=small.data.joined,aes(y=PM_mean,x=as.factor(clusterID, PM_Mean)))+
geom_boxplot()+
labs(
title = 'PM 2.5 by Cluster',
subtitle = 'By Census Tract in Los Angeles County',
x = 'Cluster ID',
y = 'PM 2.5 (ug/m3)',
) +
theme_minimal()+
scale_x_discrete(labels=c('Rural','Higher Income Suburb','Urban','Lower Income Suburb'))
ggplot(data=small.data.joined,aes(y=PM_mean,x=as.factor(clusterID, PM_Mean)))+
ggplot(data=small.data.joined,aes(y=PM_mean,x=as.factor(clusterID, PM_Mean)))+
geom_boxplot()+
labs(
title = 'PM 2.5 by Cluster',
subtitle = 'By Census Tract in Los Angeles County',
x = 'Cluster ID',
y = 'PM 2.5 (ug/m3)',
) +
theme_minimal()+
#scale_x_discrete(labels=c('Rural','Higher Income Suburb','Urban','Lower Income Suburb'))
ggplot(data=small.data.joined,aes(y=miles_bike_walked_percapita,x=as.factor(clusterID)))+
geom_boxplot()
ggplot(data=small.data.joined,aes(y=PM_mean,x=as.factor(clusterID, PM_Mean)))+
geom_boxplot()+
labs(
title = 'PM 2.5 by Cluster',
subtitle = 'By Census Tract in Los Angeles County',
x = 'Cluster ID',
y = 'PM 2.5 (ug/m3)',
) +
theme_minimal()
ggplot(data=small.data.joined,aes(y=PM_mean,x=as.factor(clusterID)))+
geom_boxplot()+
labs(
title = 'PM 2.5 by Cluster',
subtitle = 'By Census Tract in Los Angeles County',
x = 'Cluster ID',
y = 'PM 2.5 (ug/m3)',
) +
theme_minimal()
small.data.joined[small.data.joined$clusterID ==1,'clusterName'] =
aggregate(small.data.joined,
by = list(cluster = small.data.joined$clusterID),
mean) #Summary Statistics for the different clusters.
small.data.joined[small.data.joined$clusterID ==1,'clusterName'] =
aggregate(small.data.joined,
by = list(cluster = small.data.joined$clusterID),
mean) #Summary Statistics for the different clusters.
small.data.joined
small.data.joined$clusterName
small.data.joined <-
small.data.joined %>% rename(clusterID = km.cluster)
small.data.joined <-
merge(km.cluster, small.data, by.x = 'GEOID', by.y = 'GEOID')
small.data.joined <-
small.data.joined %>% rename(clusterID = km.cluster)
small.data.joined$clusterName
aggregate(small.data.joined,
by = list(cluster = small.data.joined$clusterID),
mean) #Summary Statistics for the different clusters.
aggregatedCluster <- aggregate(small.data.joined,
by = list(cluster = small.data.joined$clusterID),
mean) #Summary Statistics for the different clusters.
aggregatedCluster <- aggregate(small.data.joined,
by = list(cluster = small.data.joined$clusterID),
mean) #Summary Statistics for the different clusters.
aggregatedCluster %>% group_by(clusterID) %>%
mutate(mx=max(PM_mean)) %>%
arrange(desc(mx) %>% desc(PM_mean)) %>%
select(-mx)
aggregatedCluster <- aggregate(small.data.joined,
by = list(cluster = small.data.joined$clusterID),
mean) #Summary Statistics for the different clusters.
aggregatedCluster
arrange(desc(PM_mean)
aggregatedCluster %>%
aggregatedCluster %>%
arrange(desc(PM_mean))
aggregatedCluster <- aggregatedCluster %>%
arrange(desc(PM_mean))
aggregatedCluster
aggregatedCluster$clusterName
aggregatedCluster
aggregatedCluster[1,]
aggregatedCluster[1,'clusterName'] = 'Urban'
aggregatedCluster[1,'clusterName'] #= 'Urban'
aggregatedCluster
aggregatedCluster[2,'clusterName'] = 'Lower Income Suburbs'
aggregatedCluster[3,'clusterName'] = 'Higher Income Suburbs'
aggregatedCluster[4,'clusterName'] = 'Rural'
?merge
merge(small.data.joined,aggregatedCluster$clusterName,by.x=clusterID,by.y=clusterID)
aggregatedCluster <- aggregatedCluster %>% select('clusterID','clusterName')
aggregatedCluster
merge(small.data.joined,aggregatedCluster,by.x=clusterID,by.y=clusterID)
merge(small.data.joined,aggregatedCluster,by='clusterID')
small.data.joined <- merge(small.data.joined,aggregatedCluster,by='clusterID')
small.data.joined <-
sf::st_as_sf(small.data.joined, sf_column_name = 'geometry') #Convert back to a simple feature class.
small.data.joined$clusterName
table(small.data.joined,clusterName)
table(small.data.joined$clusterName)
ggplot(data=small.data.joined,aes(y=PM_mean,x=as.factor(clusterName)))+
geom_boxplot()+
labs(
title = 'PM 2.5 by Cluster',
subtitle = 'By Census Tract in Los Angeles County',
x = 'Cluster ID',
y = 'PM 2.5 (ug/m3)',
) +
theme_minimal()
ggplot(data=small.data.joined,aes(y=PM_mean,x=clusterName))+
geom_boxplot()+
labs(
title = 'PM 2.5 by Cluster',
subtitle = 'By Census Tract in Los Angeles County',
x = 'Cluster ID',
y = 'PM 2.5 (ug/m3)',
) +
theme_minimal()
ggplot(data=small.data.joined,aes(y=PM_mean,x=reorder(clusterName,PM_mean))+
ggplot(data=small.data.joined,aes(y=PM_mean,x=reorder(clusterName,PM_mean))+
ggplot(data=small.data.joined,aes(y=PM_mean,x=reorder(clusterName,PM_mean))+
ggplot(data=small.data.joined,aes(y=PM_mean,x=reorder(clusterName,PM_mean)))+
geom_boxplot()+
labs(
title = 'PM 2.5 by Cluster',
subtitle = 'By Census Tract in Los Angeles County',
x = 'Cluster ID',
y = 'PM 2.5 (ug/m3)',
) +
theme_minimal()
ggplot(data=small.data.joined,aes(y=PM_mean,x=reorder(clusterName,PM_mean)))+
ggplot(data=small.data.joined,aes(y=PM_mean,x=reorder(clusterName,PM_mean)))+
geom_boxplot()+
labs(
title = 'PM 2.5 by Cluster',
subtitle = 'By Census Tract in Los Angeles County',
x = 'Cluster ID',
y = 'PM 2.5 (ug/m3)',
) +
theme_minimal()
aggregatedCluster
aggregatedCluster <- aggregate(small.data.joined,
by = list(cluster = small.data.joined$clusterID),
mean) #Summary Statistics for the different clusters.
aggregatedCluster
aggregatedCluster <- aggregatedCluster %>%
arrange(desc(PM_mean)) %>%
aggregatedCluster$clusterName
aggregatedCluster <- aggregatedCluster %>%
arrange(desc(PM_mean)) %>%
aggregatedCluster$clusterName
aggregatedCluster <- aggregatedCluster %>%
arrange(desc(PM_mean))
aggregatedCluster
ggplot(
data = small.data,
mapping = aes(x = miles_bike_walked_percapita, y = PM_mean, color = nh_type_str)
) +
geom_point() +
geom_smooth(method = "lm", color = 'red') +
labs(
title = 'PM 2.5 and Active Transportation',
subtitle = 'By Census Tract in Los Angeles County',
x = 'Miles Biked and Walked per Capita (per day)',
y = 'Particulate Matter 2.5 Average (ug/m3)',
color='Neighborhood Type'
) +
#  scale_y_continuous(labels=scales::percent)+
#  scale_x_continuous(labels=scales::percent)+
theme_minimal()
## Active Transport and Density
ggplot(
data = small.data,
mapping = aes(x = pop_dens_sqm, y = miles_bike_walked_percapita, color = nh_type)
) +
geom_point() +
geom_smooth(method = "lm", color = 'red') +
labs(
title = 'Active Transport and Population Density',
subtitle = 'By Census Tract in Los Angeles County',
x = 'Population Density (per square mile)',
y = 'Miles Biked and Walked Per Capita Per Day',
) +
scale_color_manual(labels=c("1-Suburban","2-Urban","3-Rural","4-City Center"))
ggplot(
data = small.data,
mapping = aes(x = miles_bike_walked_percapita, y = PM_mean, color = nh_type_str)
) +
geom_point() +
geom_smooth(method = "lm", color = 'red') +
labs(
title = 'PM 2.5 and Active Transportation',
subtitle = 'By Census Tract in Los Angeles County',
x = 'Miles Biked and Walked per Capita (per day)',
y = 'Particulate Matter 2.5 Average (ug/m3)',
color='Neighborhood Type'
) +
scale_color_manual(labels=c("1-Suburban","2-Urban","3-Rural","4-City Center"))
scale_color_manual(labels=c("1-Suburban","2-Urban","3-Rural","4-City Center"),color=c('light green','purple','light blue','pink')
geom_smooth(method = "lm", color = 'red') +
ggplot(
ggplot(
data = small.data,
mapping = aes(x = miles_bike_walked_percapita, y = PM_mean, color = nh_type_str)
) +
geom_point() +
geom_smooth(method = "lm", color = 'red') +
labs(
title = 'PM 2.5 and Active Transportation',
subtitle = 'By Census Tract in Los Angeles County',
x = 'Miles Biked and Walked per Capita (per day)',
y = 'Particulate Matter 2.5 Average (ug/m3)',
color='Neighborhood Type'
) +
scale_color_manual(labels=c("1-Suburban","2-Urban","3-Rural","4-City Center"),color=c('light green','purple','light blue','pink'))+
theme_minimal()
# PM and Density
ggplot(data = small.data,
ggplot(
data = small.data,
mapping = aes(x = miles_bike_walked_percapita, y = PM_mean, color = nh_type_str)
) +
geom_point() +
geom_smooth(method = "lm", color = 'red') +
labs(
title = 'PM 2.5 and Active Transportation',
subtitle = 'By Census Tract in Los Angeles County',
x = 'Miles Biked and Walked per Capita (per day)',
y = 'Particulate Matter 2.5 Average (ug/m3)',
color='Neighborhood Type'
) +
scale_color_manual(labels=c("1-Suburban","2-Urban","3-Rural","4-City Center"),color=c('light green','purple','light blue','pink'))+
theme_minimal()
ggplot(
data = small.data,
mapping = aes(x = miles_bike_walked_percapita, y = PM_mean, color = nh_type_str)
) +
geom_point() +
geom_smooth(method = "lm", color = 'red') +
labs(
title = 'PM 2.5 and Active Transportation',
subtitle = 'By Census Tract in Los Angeles County',
x = 'Miles Biked and Walked per Capita (per day)',
y = 'Particulate Matter 2.5 Average (ug/m3)',
color='Neighborhood Type'
) +
scale_color_manual(labels=c("1-Suburban","2-Urban","3-Rural","4-City Center"),color=c('darkseagreen2','darkorchid1','darkslategray1','lightpink1
'))+
theme_minimal()
ggplot(
data = small.data,
mapping = aes(x = miles_bike_walked_percapita, y = PM_mean, color = nh_type_str)
) +
geom_point() +
geom_smooth(method = "lm", color = 'red') +
labs(
title = 'PM 2.5 and Active Transportation',
subtitle = 'By Census Tract in Los Angeles County',
x = 'Miles Biked and Walked per Capita (per day)',
y = 'Particulate Matter 2.5 Average (ug/m3)',
color='Neighborhood Type'
) +
scale_color_manual(labels=c("1-Suburban","2-Urban","3-Rural","4-City Center"),color=c('darkseagreen2','darkorchid1','darkslategray1','lightpink1'))+
theme_minimal()
ggplot(
data = small.data,
mapping = aes(x = miles_bike_walked_percapita, y = PM_mean, color = nh_type_str)
) +
geom_point() +
geom_smooth(method = "lm", color = 'red') +
labs(
title = 'PM 2.5 and Active Transportation',
subtitle = 'By Census Tract in Los Angeles County',
x = 'Miles Biked and Walked per Capita (per day)',
y = 'Particulate Matter 2.5 Average (ug/m3)',
color='Neighborhood Type'
) +
scale_color_manual(labels=c("1-Suburban","2-Urban","3-Rural","4-City Center"),values=c('darkseagreen2','darkorchid1','darkslategray1','lightpink1'))+
theme_minimal()
